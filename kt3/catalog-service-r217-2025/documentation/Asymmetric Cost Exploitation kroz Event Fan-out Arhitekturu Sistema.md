# 1. Uvod
Catalog Service predstavlja centralnu komponentu marketplace sistema zaduženu za obradu i propagaciju promena nad proizvodima (cena, dostupnost, metapodaci). Svaka izmena proizvoda generiše događaj koji se dalje distribuira ka drugim podsistemima kao što su indeksiranje, keširanje i analitika.

Iako sistem pravilno implementira mehanizme autentifikacije i autorizacije, njegov event-driven arhitektonski obrazac može dovesti do bezbednosne pretnje koja ne cilja podatke, već ekonomsku održivost sistema.

# 2. Definisanje pretnje i napada

## 2.1 Pretnja

**Pretnja:**
> Narušavanje ekonomske održivosti sistema kroz disproporcionalno povećanje operativnih cloud troškova.

Ova pretnja utiče na:
- integritet finansijskih resursa
- dugoročnu dostupnost servisa
- stabilnost operativnog budžeta

## 2.2 Napad

**Napad:** Asymmetric Cost Exploitation (ACE)

> ACE predstavlja napad u kome legitimna, jeftina i autorizovana operacija inicira lanac sistemskih operacija čiji zbirni trošak višestruko prevazilazi trošak inicijatora.

Napad eksploatiše arhitektonsku raspodelu troškova, a ne nedostatak kontrole pristupa.

# 3. Opšti obrazac eksploatacije

Na apstraktnom nivou, eksploatacija ima sledeći oblik:

![arh](images/arhitektura.png)

Jedna legitimna akcija generiše događaj koji se fan-out distribuira ka više potrošača, pri čemu svaki potrošač proizvodi dodatni infrastrukturni trošak.

Ako definišemo:
- `N`: broj izmena proizvoda
- `F`: broj fan-out potrošača (fan-out faktor)
- `C_worker`: trošak downstream potrošača

Ukupan trošak bez mitigacije može se aproksimirati kao:

$$
C_{total} = N \sum_{i=1}^{F} C_{worker, i}
$$


Trošak sistema raste linearno sa brojem izmena, nezavisno od njihove poslovne vrednosti.

# 4. Event Processing Segment

Segment relevantan za eksploataciju prikazan je na sledećoj slici.

![Zoom](images/zoom-in.png)

Označeni deo arhitekture obuhvata:
- generisanje Catalog događaja (izmena/brisanje/dodavanje artikla)
- SNS/SQS fan-out mehanizam
- više nezavisnih worker-a

Za jednu izmenu proizvoda sistem generiše:
- jednu publish operaciju
- više poruka u redovima
- više izvršavanja worker-a

Ovakva struktura omogućava napadaču da linearno povećava trošak sistema povećanjem broja izmena.

# 5. Identifikovana ranjivost

Ranjivost se može definisati kao:

> Nepostojanje mehanizma za amortizaciju fan-out troška u odnosu na frekvenciju i semantičku vrednost izmena.

Sistem tretira svaku izmenu kao događaj iste procesne težine.

Autorizacija korisnika ne sprečava napad, jer napadač koristi dozvoljene operacije.

# 6. Mitigacija napada

## 6.1 SNS FIFO sa deduplikacijom

Uvođenje SNS FIFO topic-a sa content-based deduplikacijom omogućava eliminisanje identičnih poruka. Ukoliko bi napadač generisao i slao isti događaj, SNS bi ga automatski odbijao u vremenskom intervalu od 5 minuta.

Međutim, male tehničke izmene (npr. minimalna promena cene) i dalje generišu nove događaje.

Zbog toga ova mera predstavlja optimizaciju, ali ne i potpunu mitigaciju napada.

## 6.2 Agregacija događaja pre fan-out distribucije

Suštinska mitigacija zahteva promenu mesta primene fan-out mehanizma.

![Solution](images/Solution.png)

Umesto da se svaki update odmah distribuira, uvodi se agregacioni sloj:
1. Aggregator obrađuje događaje
2. Poslednje stanje entiteta čuva se u pomoćnoj DynamoDB bazi
3. Periodično se generišu objedinjeni događaji
4. Tek agregirani događaji se distribuiraju ka worker-ima

## 6.3 Nova ekonomska struktura

Ako definišemo:
- `N`: broj update operacija
- `U`: broj unikatnih događaja u vremenskom prozoru
- `C_agg`: trošak agregacionog sloja

Trošak postaje:

$$
C_{total} ≈ N * C_{agg} + U * \sum_{i=1}^{F} C_{worker, i}
$$

Pošto važi: $U ≤ N$, napadač više ne može linearno povećavati trošak sistema ponovljenim izmenama nad istim entitetom.

Time se uklanja osnovni mehanizam asimetrije troška.

# 7. Kvantitativna procena ekonomske štete

Cilj ove sekcije nije određivanje konkretne cene u dolarima, već formalna analiza strukture troška i demonstracija ekonomske asimetrije između početne i mitigovane arhitekture.

Analiza se zasniva na parametarskom modelu u kome se svi downstream troškovi jednog fan-out ciklusa grupišu u jednu veličinu.

## 7.1 Definicija modela

### Period posmatranja

- `P`: period analize (npr. 1 sat)

### Frekvencija izmena

- `N`: ukupan broj update operacija u periodu `P`

### Agregacioni parametri

- `T`: agregacioni prozor (npr. 60 sekundi)
- `K` = $\frac{P}{T}$: broj flush ciklusa u periodu
- `U`: ukupan broj agregiranih događaja u periodu `P`

Važi:

$$
U \le N
$$

## 7.2 Definicija troškovnih parametara

### Downstream trošak

- `X`: ukupan prosečan trošak jednog kompletnog fan-out ciklusa za jedan događaj.

U posmatranom segmentu, `X` uključuje:
- SQS operacije
- Lambda izvršavanja worker-a
- logovanje i metrike
- sve downstream infrastrukturne troškove

### Agregacioni trošak
- `a`: prosečan trošak agregacije po jednom update-u
- `f`: trošak jednog flush ciklusa

Ukupan agregacioni trošak u periodu `P`:

$$
C_{agg} = N \cdot a + K \cdot f
$$

## 7.3 Trošak pre mitigacije

$$
C_{before} = N \cdot X
$$

Trošak raste linearno sa brojem izmena.

## 7.4 Trošak nakon mitigacije

$$
C_{after} = N \cdot a + K \cdot f + U \cdot X
$$

## 7.5 Faktor uštede

$$
Savings = \frac{C_{before}}{C_{after}}
$$

$$
Savings = \frac{N \cdot X}{U \cdot X + N \cdot a + K \cdot f}
$$

## 7.6 Break-even analiza

$$
N \cdot X > U \cdot X + N \cdot a + K \cdot f
$$

$$
(N - U) \cdot X > N \cdot a + K \cdot f
$$

## 7.7 Analiza graničnih slučajeva

### Slučaj 1: Nema koristi od agregacije

Ako je:
$$
U = N
$$

tada:

$$
C_{after} \approx N \cdot X + N \cdot a + K \cdot f
$$

### Slučaj 2: Maksimalni efekat (napadni obrazac)

Ako:

$$
U \approx 1
$$

$$
C_{after} \approx X + N \cdot a + K \cdot f
$$

$$
C_{before} = N \cdot X
$$

$$
Savings \approx \frac{N \cdot X}{X + N \cdot a + K \cdot f}
$$

Ako važi:

$$
a \ll X
$$

faktor uštede raste približno proporcionalno sa `N`.

## 7.8 Interpretacija modela

Model pokazuje da je ekonomska ranjivost početne arhitekture posledica činjenice da se `X` plaća `N` puta.

U mitigovanoj arhitekturi:
- `X` se plaća `U` puta
- ostatak troška čine jeftinije operacije (`a` i `f`)

Ako je agregacioni sloj značajno jeftiniji od downstream obrade ($a \ll X$), mitigacija uvodi amortizaciju troška i uklanja linearnu zavisnost od broja ponovljenih izmena nad istim entitetom.

# 8. Zaključak

Asymmetric Cost Exploitation predstavlja napad koji eksploatiše arhitektonsku raspodelu troškova u event-driven sistemima.

Iako ne narušava poverljivost niti integritet poslovnih podataka, napad direktno ugrožava:
- integritet infrastrukturnih resursa
- ekonomsku održivost sistema
- dugoročnu dostupnost servisa

Mitigacija zahteva promenu ekonomske strukture sistema, a ne samo optimizaciju postojećeg fan-out modela.
